
syntax = "proto3";
package rexecd;

service Rexecd {
  rpc Command(CommandRequest) returns (stream CommandResponse) {}
  rpc RegisterHost(RegisterHostRequest) returns (RegisterHostResponse) {}
  rpc RegisterUser(RegisterUserRequest) returns (RegisterUserResponse) {}
}

message RegisterHostRequest {
  uint64 id = 1;
  string fqdn = 2;
  uint32 port = 3;
  bytes  private_key = 4;
  bytes  public_key = 5;
  // Must be specified for host key verification. One of the following:
  //
  // ssh-rsa
  // ssh-dss
  // ecdsa-sha2-nistp256
  // ecdsa-sha2-nistp384
  // ecdsa-sha2-nistp521
  // ssh-ed25519
  // ssh-rsa
  // rsa-sha2-256
  // rsa-sha2-512
  string key_type = 6;
}

message RegisterHostResponse {}

message RegisterUserRequest {
  string username = 1;
  string first_name = 2;
  string last_name = 3;
  bool   admin = 4;
  bytes  private_key = 5;
  bytes  public_key = 6;
}

message RegisterUserResponse {}

message CommandRequest {
  uint64 id = 1;
  string cmd = 2;
  string username = 3;
  uint64 host_id = 4;
  uint64 start_timestamp = 5;
}

message CommandResponse {
  uint64 id = 1;
  bytes stdout = 2;
  bytes stderr = 3;
  uint64 timestamp = 4;
  uint32 exit_code = 5;
}
